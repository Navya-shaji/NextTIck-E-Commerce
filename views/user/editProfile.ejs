<%- include("../../views/partials/user/header.ejs") %>

    <head>
        <link rel="stylesheet" href="/styles/profile.css">
    </head>

    <main class="main">
        <div class="breadcrumb-wrap">
            <div class="container">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/">Home</a></li>
                        <li class="breadcrumb-item"><a href="/userProfile">My Account</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Edit Profile</li>
                    </ol>
                </nav>
            </div>
        </div>

        <div class="profile-container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="profile-content-card">
                        <div class="section-title">
                            <span>Edit Profile</span>
                            <a href="/userProfile" class="btn-outline-gold">Back to Profile</a>
                        </div>

                        <form id="editProfileForm" class="mt-4">
                            <div class="mb-4">
                                <label for="name" class="info-label">Full Name</label>
                                <input type="text" class="form-control" id="name" name="name" value="<%= user.name %>"
                                    required>
                            </div>

                            <div class="mb-4">
                                <label for="phone" class="info-label">Phone Number</label>
                                <input type="tel" class="form-control" id="phone" name="phone" value="<%= user.phone %>"
                                    placeholder="Enter phone number">
                            </div>

                            <div class="d-flex justify-content-end gap-3 mt-5">
                                <a href="/userProfile" class="btn-outline-gold">Cancel</a>
                                <button type="submit" class="btn-gold" id="saveButton">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <%- include("../../views/partials/user/footer.ejs") %>

        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            document.getElementById('editProfileForm').addEventListener('submit', async function (e) {
                e.preventDefault();

                const name = document.getElementById('name').value;
                const phone = document.getElementById('phone').value;
                const saveButton = document.getElementById('saveButton');

                if (!name.trim()) {
                    return Swal.fire('Error', 'Name is required', 'error');
                }

                saveButton.disabled = true;
                saveButton.innerHTML = 'Saving...';

                try {
                    const response = await fetch('/update-profile', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ name: name.trim(), phone: phone ? phone.trim() : '' })
                    });

                    const data = await response.json();

                    if (data.success) {
                        await Swal.fire({
                            icon: 'success',
                            title: 'Profile Updated',
                            text: 'Your profile has been successfully updated.',
                            showConfirmButton: false,
                            timer: 1500
                        });
                        window.location.href = '/userProfile';
                    } else {
                        throw new Error(data.message);
                    }
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: error.message || 'Something went wrong',
                    });
                    saveButton.disabled = false;
                    saveButton.innerHTML = 'Save Changes';
                }
            });
        </script>